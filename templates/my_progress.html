{% extends "base.html" %}

{% block title %}My Progress{% endblock %}

{% block head_extra %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div class="container" style="padding: 2rem; max-width: 1000px; margin: 0 auto;">
    <h1 style="margin-bottom: 2rem; text-align: center;">My Progress</h1>
    
    <!-- Chart Section -->
    <div style="background: var(--surface); padding: 2rem; border-radius: var(--radius); border: 1px solid var(--border); margin-bottom: 2rem; box-shadow: var(--shadow);">
        <h3 style="margin-top: 0; margin-bottom: 1.5rem;">Accuracy Over Time</h3>
        <div style="height: 300px;">
            <canvas id="accuracyChart"></canvas>
        </div>
    </div>

    <!-- Topic Breakdown -->
    <div style="background: var(--surface); padding: 2rem; border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow);">
        <h3 style="margin-top: 0; margin-bottom: 1.5rem;">Topic Breakdown</h3>
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; color: var(--text);">
                <thead>
                    <tr style="border-bottom: 2px solid var(--border); text-align: left;">
                        <th style="padding: 12px;">Topic</th>
                        <th style="padding: 12px;">Avg Score</th>
                        <th style="padding: 12px;">Status</th>
                        <th style="padding: 12px;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for topic in topics %}
                    <tr style="border-bottom: 1px solid var(--border);">
                        <td style="padding: 12px;">{{ topic.name }}</td>
                        <td style="padding: 12px;">{{ topic.avg_score }}%</td>
                        <td style="padding: 12px;">
                            {% if topic.is_weak %}
                            <span style="color: #ef4444; font-weight: bold; background: rgba(239, 68, 68, 0.1); padding: 4px 8px; border-radius: 4px;">Weak</span>
                            {% else %}
                            <span style="color: #22c55e; font-weight: bold; background: rgba(34, 197, 94, 0.1); padding: 4px 8px; border-radius: 4px;">Strong</span>
                            {% endif %}
                        </td>
                        <td style="padding: 12px;">
                            <a href="{{ url_for('start_topic_quiz', topic=topic.name) }}" style="display: inline-block; background: var(--primary); color: white; padding: 6px 12px; border-radius: 6px; text-decoration: none; font-size: 0.9rem;">Practice</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" style="padding: 24px; text-align: center; color: var(--muted);">No practice data available yet. Start a quiz to track your progress!</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div style="margin-top: 2rem; text-align: center;">
        <a href="{{ url_for('my_questions') }}" style="display: inline-block; background: transparent; border: 1px solid var(--border); color: var(--text); padding: 10px 20px; border-radius: 8px; text-decoration: none; transition: background 0.2s;">View Attempt History</a>
    </div>

    <!-- Privacy Note -->
    <div style="margin-top: 3rem; text-align: center; color: var(--muted); font-size: 0.8rem; border-top: 1px solid var(--border); padding-top: 1rem;">
        <p>
            <span style="opacity: 0.7;">ðŸ”’ Privacy: Your progress is saved securely to this browser. We anonymize and remove old data periodically.</span>
        </p>
    </div>
</div>

<script>
    const ctx = document.getElementById('accuracyChart').getContext('2d');
    const accuracyChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ dates|tojson }},
            datasets: [{
                label: 'Accuracy (%)',
                data: {{ accuracies|tojson }},
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.2)',
                tension: 0.4,
                fill: true,
                pointBackgroundColor: '#3b82f6',
                pointRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    grid: { color: '#334155' },
                    ticks: { color: '#94a3b8' }
                },
                x: {
                    grid: { color: '#334155' },
                    ticks: { color: '#94a3b8' }
                }
            },
            plugins: {
                legend: { labels: { color: '#f1f5f9' } },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.raw + '%';
                        }
                    }
                }
            }
        }
    });
</script>
{% endblock %}
