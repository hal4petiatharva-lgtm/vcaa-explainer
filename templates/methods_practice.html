<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>VCAA Methods Practice Engine</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <style>
        .methods-container { max-width: 800px; margin: 0 auto; padding: 2rem 1rem; }
        .question-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-xl); padding: 2rem; box-shadow: var(--shadow); margin-bottom: 2rem; }
        .question-meta { color: var(--muted); font-size: 0.9rem; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .question-text { font-size: 1.25rem; font-weight: 500; margin-bottom: 1.5rem; line-height: 1.6; }
        .input-group { margin-bottom: 1.5rem; }
        .input-group label { display: block; margin-bottom: 0.5rem; color: var(--muted); font-size: 0.9rem; }
        .form-input { width: 100%; padding: 1rem; background: #0b1220; color: var(--text); border: 1px solid var(--border); border-radius: var(--radius); font-size: 1rem; }
        .feedback-card { background: rgba(59,130,246,0.1); border: 1px solid var(--primary); border-radius: var(--radius); padding: 1.5rem; margin-top: 1.5rem; animation: slideIn 0.3s ease-out; }
        .feedback-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .mark-badge { background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 999px; font-weight: 600; font-size: 0.9rem; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; padding: 1rem 2rem; border-radius: var(--radius); font-weight: 600; cursor: pointer; width: 100%; font-size: 1rem; transition: transform 0.2s; }
        .btn-primary:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-secondary { background: transparent; border: 1px solid var(--border); color: var(--text); padding: 1rem 2rem; border-radius: var(--radius); cursor: pointer; width: 100%; margin-top: 1rem; }
        .btn-secondary:hover { background: rgba(255,255,255,0.05); }
        .warning-box { background: rgba(234, 179, 8, 0.1); border: 1px solid rgba(234, 179, 8, 0.3); color: #fde047; padding: 1rem; border-radius: var(--radius); margin-bottom: 1.5rem; }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="header">
        <div class="brand-super">VCEInsider's</div>
        <h1 class="tool-name">Methods Engine</h1>
        <p class="tagline">AI-Marked VCAA Practice Questions</p>
      </div>
      <a href="/" style="color: var(--muted); text-decoration: none; font-size: 0.9rem;">← Back to Command Term Explainer</a>
    </header>

    <main class="methods-container">
      <div class="question-card">
        <div class="question-meta">
            Question {{ question.id }} • {{ question.type|upper }} • {{ question.marks }} Marks
        </div>
        <div class="question-text">
            {{ question.text }}
        </div>

        {% if feedback %}
        <div class="feedback-card" style="border-color: {% if feedback.is_correct %}#22c55e{% else %}#eab308{% endif %}; background: {% if feedback.is_correct %}rgba(34,197,94,0.1){% else %}rgba(234,179,8,0.1){% endif %}">
            <div class="feedback-header">
                <h3 style="margin:0; color: {% if feedback.is_correct %}#4ade80{% else %}#fde047{% endif %}">
                    {% if feedback.is_correct %}Correct!{% else %}Assessment{% endif %}
                </h3>
                <span class="mark-badge" style="background: {% if feedback.is_correct %}#22c55e{% else %}#eab308{% endif %}">
                    {{ feedback.mark }} / {{ feedback.max_marks }}
                </span>
            </div>
            <p style="margin:0; line-height: 1.6;">{{ feedback.feedback }}</p>
        </div>
        {% endif %}

        {% if not feedback or not feedback.is_correct %}
        <form method="POST" action="/methods-practice" style="margin-top: 2rem;">
            {% if speed_warning %}
            <div class="warning-box">
                <strong>⚡️ Whoa there!</strong> You answered that very quickly (< 3s).<br>
                To ensure valid practice, please briefly explain your working out below.
            </div>
            <div class="input-group">
                <label>Working / Reasoning</label>
                <textarea name="working" class="form-input" rows="3" placeholder="e.g. Used chain rule..." required></textarea>
            </div>
            {% endif %}

            <div class="input-group">
                <label>Your Answer</label>
                <input type="text" name="answer" class="form-input" value="{{ user_answer or '' }}" placeholder="Enter your final answer..." required autocomplete="off">
            </div>
            
            <button type="submit" class="btn-primary">
                {% if feedback %}Try Again{% else %}Submit Answer{% endif %}
            </button>
        </form>
        {% endif %}

        {% if feedback and (feedback.is_correct or attempts >= 3) %}
        <div style="margin-top: 2rem;">
            <a href="{{ url_for('methods_practice', action='next') }}">
                <button class="btn-primary">Next Question →</button>
            </a>
        </div>
        {% endif %}
      </div>
    </main>
  </body>
</html>
